
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Argument Writing Trainer - Dark Mode</title>
  <style>
    :root { color-scheme: dark; }
    body {
      font-family: system-ui;
      max-width: 1000px;
      margin: 20px auto;
      padding: 0 16px 32px;
      line-height: 1.6;
      background: #0f172a;
      color: #e5e7eb;
    }
    .card {
      background: #020617;
      border-radius: 14px;
      padding: 16px 18px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.75);
      border: 1px solid #1f2937;
      margin-bottom: 18px;
    }
    select, textarea, button { font-size: 1rem; }
    select {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      min-width: 320px;
      background: #020617;
      color: #e5e7eb;
    }
    .topic-box {
      border-radius: 10px;
      padding: 10px 12px;
      background: #020617;
      border: 1px solid #1f2937;
      margin-top: 10px;
    }
    textarea {
      width: 100%;
      height: 220px;
      padding: 10px;
      border-radius: 10px;
      background: #020617;
      color: #e5e7eb;
      border: 1px solid #374151;
    }
    button.primary {
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      border-radius: 999px;
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
    }
    button.secondary {
      background: #111827;
      border: 1px solid #374151;
      padding: 8px 16px;
      border-radius: 999px;
      color: #e5e7eb;
      cursor: pointer;
    }
    .list-box {
      background: #020617;
      border: 1px solid #1f2937;
      border-radius: 10px;
      padding: 10px;
      max-height: 260px;
      overflow: auto;
    }
    .columns {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }
    .small {
      padding: 4px 10px;
      background: #0f172a;
      border: 1px solid #374151;
      border-radius: 999px;
      color: #e5e7eb;
      font-size: 0.8rem;
      cursor: pointer;
      margin-right: 4px;
    }
    .sample-box {
      margin-top: 6px;
      font-size: 0.9rem;
      color: #9ca3af;
      line-height: 1.4;
    }
    #result { margin-top: 10px; font-size: 0.95rem; }
    .answer-audio-controls {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      font-size: 0.85rem;
      color: #9ca3af;
    }
    .answer-audio-controls input[type="range"] {
      width: 140px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Argument Writing Trainer <span class="accent">Dark</span></h1>
  </div>

  <div class="card">
    <label for="topicSelect">トピックを選んでください：</label><br>
    <select id="topicSelect"></select>

    <div class="topic-box">
      <div id="topicSentence" style="margin-top:6px;"></div>
    </div>

    <div class="columns" style="margin-top:10px;">
      <div class="list-box">
        <h3>肯定的な理由（Pro reasons）</h3>
        <div id="proList"></div>
      </div>
      <div class="list-box">
        <h3>反駁例（Counter-arguments）</h3>
        <div id="rebuttalList"></div>
      </div>
    </div>

    <div style="margin-top:10px;">
      <span>理由・反駁の読み上げ速度：</span>
      <input type="range" id="rateRange" min="0.6" max="1.4" step="0.05" value="0.95">
      <span id="rateLabel">0.95</span>
      <button id="stopAllBtn" class="small">■ 停止</button>
    </div>
  </div>

  <div class="card">
    <h2>あなたの反駁ライティング</h2>

    <div class="sample-box">
      ★ I agree with you to some extent, but I don't think it is a good idea. That's because<br>
      ★ That makes sense, but I would argue that 
    </div>

    <textarea id="writingArea" placeholder="Write your counter-argument here..."></textarea>
    <div>
      <button id="analyzeBtn" class="primary">終了</button>
      <button id="clearBtn" class="secondary">クリア</button>
    </div>
  </div>

  <div class="card" id="result">
    （結果がここに表示されます）
  </div>

  <script>
    const topics = [
      {
        sentence: "We should always ask a parent or teacher if a story is real.",
        pros: [
          "They can help us know if a story is true or not.",
          "Children do not always know what is real.",
          "Parents and teachers usually have more experience.",
          "They can explain difficult ideas in a simple way.",
          "We can avoid believing dangerous rumors.",
          "It helps us feel safe when we are not sure.",
          "We can learn how to check information correctly.",
          "They can tell us which sources are reliable.",
          "It prevents us from sharing fake stories with friends.",
          "It builds a good habit of asking for advice."
        ],
        rebuttals: [
          "We also need to learn to think by ourselves.",
          "Parents and teachers can sometimes be wrong.",
          "They are not always near us when we read something.",
          "We can compare different sources by ourselves.",
          "Always asking may make us too dependent.",
          "We can use libraries and official websites too.",
          "Some stories do not need advice, like simple jokes.",
          "We should learn basic skills to check facts alone.",
          "Different adults may have different opinions.",
          "We need to develop our own critical thinking."
        ]
      },
      {
        sentence: "Stop using our smartphones should be more encouraged.",
        pros: [
          "We can spend more time talking with family and friends.",
          "It helps students focus more on their homework.",
          "Less screen time is better for our eyes.",
          "We can sleep better if we use phones less at night.",
          "We have more time to play sports and exercise.",
          "It reduces the chance of smartphone addiction.",
          "We can enjoy real life activities, not only screens.",
          "It may reduce online bullying and stress.",
          "We can learn to live without our phones for a while.",
          "It teaches us to use technology in a balanced way."
        ],
        rebuttals: [
          "Smartphones are very useful tools in daily life.",
          "We often need them to contact family and friends.",
          "Students sometimes use phones to study or search.",
          "In an emergency, smartphones can save lives.",
          "Some people work using their smartphones.",
          "We can learn self-control without stopping completely.",
          "Too strict rules may make students feel stressed.",
          "We can set time limits instead of fully stopping.",
          "Many school apps and systems require smartphones.",
          "The problem is how we use them, not the phones themselves."
        ]
      },
      {
        sentence: "We should trust all information from our teachers.",
        pros: [
          "Teachers study a lot to teach correct information.",
          "They usually use textbooks and reliable materials.",
          "Trust helps classes run smoothly.",
          "Students can feel safe and relaxed in class.",
          "Teachers often have real experience in their subject.",
          "Respecting teachers is an important value in school.",
          "They can answer questions and give clear explanations.",
          "Trusting them saves time in the classroom.",
          "They usually check information before teaching it.",
          "Trust makes the relationship between students and teachers stronger."
        ],
        rebuttals: [
          "Teachers are also human and can make mistakes.",
          "New information may change old knowledge.",
          "We should also check facts by ourselves.",
          "Critical thinking is an important skill for the future.",
          "Different teachers may have different opinions.",
          "Sometimes personal opinions are mixed with facts.",
          "Students can bring new information from outside the class.",
          "Asking questions can improve understanding.",
          "Blind trust may be dangerous in some situations.",
          "We should respect teachers but still think carefully."
        ]
      }
    ];

    const topicSelect = document.getElementById("topicSelect");
    const topicSentence = document.getElementById("topicSentence");
    const proList = document.getElementById("proList");
    const rebuttalList = document.getElementById("rebuttalList");
    const writingArea = document.getElementById("writingArea");
    const resultDiv = document.getElementById("result");
    const rateRange = document.getElementById("rateRange");
    const rateLabel = document.getElementById("rateLabel");
    const stopAllBtn = document.getElementById("stopAllBtn");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const clearBtn = document.getElementById("clearBtn");

    // 音声まわりの関数（短い文用）
    function speakShort(text, rate) {
      if (!window.speechSynthesis) {
        alert("このブラウザでは音声読み上げに対応していません。");
        return;
      }
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.rate = rate || 1.0;
      speechSynthesis.speak(u);
    }

    // 長い英文を文ごとに分けて順番に読み上げる（ライティング用）
    function splitIntoChunks(text) {
      const sentences = [];
      let current = "";
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        current += ch;
        if (/[.!?]/.test(ch)) {
          if (current.trim().length > 0) {
            sentences.push(current.trim());
          }
          current = "";
        }
      }
      if (current.trim().length > 0) {
        sentences.push(current.trim());
      }
      return sentences;
    }

    function speakLong(text, rate) {
      if (!window.speechSynthesis) {
        alert("このブラウザでは音声読み上げに対応していません。");
        return;
      }
      speechSynthesis.cancel();
      const chunks = splitIntoChunks(text);
      if (chunks.length === 0) return;
      chunks.forEach(chunk => {
        const u = new SpeechSynthesisUtterance(chunk);
        u.lang = "en-US";
        u.rate = rate || 1.0;
        speechSynthesis.speak(u);
      });
    }

    // トピックセレクト初期化
    topics.forEach((t, i) => {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = t.sentence;
      topicSelect.appendChild(opt);
    });

    function renderTopic(index) {
      const t = topics[index];
      topicSentence.textContent = t.sentence;

      // Pro reasons with audio buttons
      proList.innerHTML = "";
      t.pros.forEach(reason => {
        const row = document.createElement("div");
        row.className = "pro-item";
        const btn = document.createElement("button");
        btn.className = "small";
        btn.textContent = "▶";
        btn.onclick = () => speakShort(reason, parseFloat(rateRange.value));
        const span = document.createElement("span");
        span.textContent = reason;
        row.appendChild(btn);
        row.appendChild(span);
        proList.appendChild(row);
      });

      // Rebuttals with audio buttons
      rebuttalList.innerHTML = "";
      t.rebuttals.forEach(r => {
        const row = document.createElement("div");
        row.className = "rebuttal-item";
        const btn = document.createElement("button");
        btn.className = "small";
        btn.textContent = "▶";
        btn.onclick = () => speakShort(r, parseFloat(rateRange.value));
        const span = document.createElement("span");
        span.textContent = r;
        row.appendChild(btn);
        row.appendChild(span);
        rebuttalList.appendChild(row);
      });
    }

    topicSelect.addEventListener("change", () => {
      renderTopic(topicSelect.value);
    });

    // 初期トピック表示
    renderTopic(0);

    rateRange.addEventListener("input", () => {
      rateLabel.textContent = rateRange.value;
    });

    stopAllBtn.addEventListener("click", () => {
      speechSynthesis.cancel();
    });

    clearBtn.addEventListener("click", () => {
      writingArea.value = "";
      resultDiv.textContent = "（結果がここに表示されます）";
    });

    analyzeBtn.addEventListener("click", () => {
      const raw = writingArea.value;
      const txt = raw.trim();
      if (!txt) {
        resultDiv.textContent = "何も書かれていません。";
        return;
      }
      const words = txt.split(/\s+/).length;

      let html = "";
      html += "<div class='result-section'>";
      html += "<h3>語数</h3>";
      html += "<p>" + words + " 語</p>";
      html += "<h3>あなたの解答</h3>";
      html += "<p>" + txt.replace(/\n/g, "<br>") + "</p>";
      html += "<div class='answer-audio-controls'>";
      html += "<span>自分の解答の速度：</span>";
      html += "<input type='range' id='answerRateRange' min='0.6' max='1.4' step='0.05' value='1.0'>";
      html += "<span id='answerRateLabel'>1.0</span>";
      html += "<button id='playAnswerBtn' class='small'>▶ 再生</button>";
      html += "</div>";
      html += "</div>";

      resultDiv.innerHTML = html;

      const answerRateRange = document.getElementById("answerRateRange");
      const answerRateLabel = document.getElementById("answerRateLabel");
      const playAnswerBtn = document.getElementById("playAnswerBtn");

      answerRateRange.addEventListener("input", () => {
        answerRateLabel.textContent = answerRateRange.value;
      });

      playAnswerBtn.addEventListener("click", () => {
        speakLong(raw, parseFloat(answerRateRange.value));
      });
    });
  </script>
</body>
</html>
